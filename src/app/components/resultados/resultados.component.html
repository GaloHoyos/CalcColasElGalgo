<div *ngIf="result" class="results">
  <h4>Resultados del Sistema {{ queueType }}</h4>

  <!-- Advertencia de sistema inestable -->
  <div *ngIf="result.isUnstable" class="warning-alert">
    <strong>{{ result.warningMessage }}</strong>
    <p>
      La simulaci√≥n puede seguir ejecut√°ndose, pero los valores te√≥ricos pueden
      divergir del comportamiento real.
    </p>
  </div>

  <!-- Mensaje informativo para sistemas estables con alta utilizaci√≥n (como MM1N) -->
  <div *ngIf="!result.isUnstable && result.warningMessage" class="info-alert">
    <strong>{{ result.warningMessage }}</strong>
  </div>

  <!-- Advertencia para prioridades -->
  <div *ngIf="result.priorityData?.isUnstable" class="warning-alert">
    <strong>{{ result.priorityData?.warningMessage }}</strong>
    <p>
      La simulaci√≥n puede seguir ejecut√°ndose, pero los valores te√≥ricos pueden
      divergir del comportamiento real.
    </p>
  </div>

  <!-- M√©tricas b√°sicas comunes a todos los modelos -->
  <div class="results-grid">
    <div class="card">
      <h5>M√©tricas B√°sicas</h5>
      <div class="metric">
        <span class="metric-label">Utilizaci√≥n del sistema (œÅ):</span>
        <span class="metric-value">{{ result.rho | number : "1.4-4" }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Utilizaci√≥n del sistema:</span>
        <span class="metric-value"
          >{{ result.rho * 100 | number : "1.2-2" }}%</span
        >
      </div>
      <div class="metric">
        <span class="metric-label">Prob. sistema vac√≠o (P‚ÇÄ):</span>
        <span class="metric-value">{{ result.P0 | number : "1.4-4" }}</span>
      </div>
    </div>

    <div class="card">
      <h5>N√∫mero Promedio</h5>
      <div class="metric">
        <span class="metric-label">En el sistema (Ls):</span>
        <span class="metric-value">{{ result.L | number : "1.4-4" }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">En la cola (Lq):</span>
        <span class="metric-value">{{ result.Lq | number : "1.4-4" }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Siendo atendidos:</span>
        <span class="metric-value">{{
          result.L - result.Lq | number : "1.4-4"
        }}</span>
      </div>
    </div>

    <div class="card">
      <h5>Tiempo Promedio</h5>
      <div class="metric">
        <span class="metric-label">En el sistema (Ws):</span>
        <span class="metric-value">{{ result.W | number : "1.4-4" }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">En la cola (Wq):</span>
        <span class="metric-value">{{ result.Wq | number : "1.4-4" }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">De servicio:</span>
        <span class="metric-value">{{
          result.W - result.Wq | number : "1.4-4"
        }}</span>
      </div>
    </div>
  </div>

  <!-- Secciones espec√≠ficas seg√∫n el modelo -->

  <!-- MM1N: Capacidad finita -->
  <div *ngIf="queueType === 'MM1N'" class="results-grid additional-metrics">
    <div class="card">
      <h5>M√©tricas Espec√≠ficas MM1N</h5>
      <div class="metric">
        <span class="metric-label">Prob. de rechazo (Pn):</span>
        <span class="metric-value">{{
          getRejectionProbability() | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Tasa efectiva (Œªef):</span>
        <span class="metric-value">{{
          params.lambda * (1 - getRejectionProbability()) | number : "1.4-4"
        }}</span>
      </div>
    </div>
  </div>

  <!-- MM2: M√∫ltiples servidores -->
  <div *ngIf="queueType === 'MM2'" class="results-grid additional-metrics">
    <div class="card">
      <h5>M√©tricas Espec√≠ficas MM2</h5>
      <div class="metric">
        <span class="metric-label">Prob. de esperar (Pw):</span>
        <span class="metric-value">{{
          getWaitingProbability() | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Prob. 1 servidor ocupado:</span>
        <span class="metric-value">{{
          getProbabilityN(1) | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Prob. 2 servidores ocupados:</span>
        <span class="metric-value">{{
          getProbabilityN(2) | number : "1.4-4"
        }}</span>
      </div>
    </div>

    <!-- Informaci√≥n adicional del sistema MM2 -->
    <div *ngIf="!hasDifferentServerSpeeds()" class="card">
      <h5>Configuraci√≥n del Sistema</h5>
      <div class="metric">
        <span class="metric-label">Capacidad total del sistema:</span>
        <span class="metric-value"
          >{{ params.mu * 2 | number : "1.1-1" }} clientes/hora</span
        >
      </div>
      <div class="metric">
        <span class="metric-label">Tasa por servidor:</span>
        <span class="metric-value"
          >{{ params.mu | number : "1.1-1" }} clientes/hora</span
        >
      </div>
      <div class="metric">
        <span class="metric-label">Tipo de servidores:</span>
        <span class="metric-value">Id√©nticos (misma velocidad)</span>
      </div>
    </div>

    <!-- M√©tricas adicionales para MM2 con selecci√≥n de servidor -->
    <div *ngIf="hasDifferentServerSpeeds()" class="additional-metrics">
      <h3
        style="
          color: #333;
          margin-bottom: 25px;
          text-align: center;
          font-size: 1.4em;
        "
      >
        MM2 con Selecci√≥n Inteligente de Servidor
      </h3>

      <div class="metrics-section system-parameters">
        <h4>‚öôÔ∏è Configuraci√≥n de Servidores Heterog√©neos</h4>
        <div class="results-grid">
          <div class="metric-card">
            <h5>Servidor R√°pido</h5>
            <p style="font-size: 1.3em; font-weight: bold; color: #4caf50">
              Œº‚ÇÅ = {{ getFasterServerRate() | number : "1.1-1" }}
            </p>
            <small style="color: #666">clientes/hora</small>
          </div>
          <div class="metric-card">
            <h5>Servidor Lento</h5>
            <p style="font-size: 1.3em; font-weight: bold; color: #ff9800">
              Œº‚ÇÇ = {{ getSlowerServerRate() | number : "1.1-1" }}
            </p>
            <small style="color: #666">clientes/hora</small>
          </div>
          <div class="metric-card">
            <h5>Relaci√≥n de Velocidades</h5>
            <p style="font-size: 1.3em; font-weight: bold; color: #2196f3">
              {{ getServerSpeedRatio() | number : "1.2-2" }} : 1
            </p>
            <small style="color: #666">Œº_r√°pido / Œº_lento</small>
          </div>
          <div class="metric-card">
            <h5>Factor de Eficiencia</h5>
            <p style="font-size: 1.3em; font-weight: bold; color: #9c27b0">
              a' = {{ result.aPrime | number : "1.2-2" }}
            </p>
            <small style="color: #666">Tasa efectiva con selecci√≥n</small>
          </div>
        </div>
      </div>

      <!-- Comparaci√≥n: Con vs Sin Selecci√≥n -->
      <div class="metrics-section comparison-section">
        <h4>üìä Comparaci√≥n: Con vs Sin Selecci√≥n de Servidor</h4>

        <div class="metric-cards-grid">
          <div class="comparison-metric-card">
            <h5>üéØ Probabilidad Sistema Vac√≠o (P‚ÇÄ)</h5>
            <div class="comparison-values">
              <div class="comparison-row">
                <span class="comparison-label">Sin selecci√≥n:</span>
                <span class="comparison-value value-without-selection">
                  {{ getMM2WithoutSelection().P0 * 100 | number : "1.1-1" }}%
                </span>
              </div>
              <div class="comparison-row">
                <span class="comparison-label">Con selecci√≥n:</span>
                <span class="comparison-value value-with-selection">
                  {{ result.P0 * 100 | number : "1.1-1" }}%
                </span>
              </div>
            </div>
          </div>

          <div class="comparison-metric-card">
            <h5>üë• N√∫mero Medio de Clientes (L)</h5>
            <div class="comparison-values">
              <div class="comparison-row">
                <span class="comparison-label">Sin selecci√≥n:</span>
                <span class="comparison-value value-without-selection">
                  {{ getMM2WithoutSelection().L | number : "1.2-2" }} clientes
                </span>
              </div>
              <div class="comparison-row">
                <span class="comparison-label">Con selecci√≥n:</span>
                <span class="comparison-value value-with-selection">
                  {{ result.L | number : "1.2-2" }} clientes
                </span>
              </div>
            </div>
          </div>

          <div class="comparison-metric-card">
            <h5>‚è±Ô∏è Tiempo Promedio en Sistema (W)</h5>
            <div class="comparison-values">
              <div class="comparison-row">
                <span class="comparison-label">Sin selecci√≥n:</span>
                <span class="comparison-value value-without-selection">
                  {{ getMM2WithoutSelection().W | number : "1.3-3" }} horas
                </span>
              </div>
              <div class="comparison-row">
                <span class="comparison-label">Con selecci√≥n:</span>
                <span class="comparison-value value-with-selection">
                  {{ result.W | number : "1.3-3" }} horas
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MG1: Servicio con distribuci√≥n general -->
  <div *ngIf="queueType === 'MG1'" class="results-grid additional-metrics">
    <div class="card">
      <h5>M√©tricas Espec√≠ficas MG1</h5>
      <div class="metric">
        <span class="metric-label">Factor de condici√≥n (C):</span>
        <span class="metric-value">{{
          getConditionFactor() | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Coef. de variaci√≥n:</span>
        <span class="metric-value">{{
          params.sigma * params.mu | number : "1.4-4"
        }}</span>
      </div>
    </div>
  </div>

  <!-- MD1: Servicio determin√≠stico -->
  <div *ngIf="queueType === 'MD1'" class="results-grid additional-metrics">
    <div class="card">
      <h5>M√©tricas Espec√≠ficas MD1</h5>
      <div class="metric">
        <span class="metric-label">Lq (√≥ptimo):</span>
        <span class="metric-value">{{
          (result.rho * result.rho) / (2 * (1 - result.rho)) | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Comparaci√≥n con MM1:</span>
        <span class="metric-value">50% menos de espera</span>
      </div>
    </div>
  </div>

  <!-- Gr√°fico de probabilidades para MM1, MM1N y MM2 -->
  <div
    *ngIf="['MM1', 'MM1N', 'MM2'].includes(queueType)"
    class="card probability-chart"
  >
    <h5>Probabilidades de Estados (P‚ÇÄ a P‚ÇÖ)</h5>
    <div class="probability-bars">
      <div *ngFor="let n of [0, 1, 2, 3, 4, 5]" class="probability-bar">
        <div class="bar-label">P{{ n }}</div>
        <div class="bar-container">
          <div
            class="bar"
            [style.width.%]="getProbabilityN(n) * 100"
            [class.disabled]="!isStateAllowed(n)"
          ></div>
        </div>
        <div class="bar-value" [class.disabled-text]="!isStateAllowed(n)">
          {{ getProbabilityN(n) | number : "1.2-2" }}
          <span *ngIf="!isStateAllowed(n)" class="not-possible">imposible</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Priority: Sistema con prioridades -->
  <div
    *ngIf="queueType === 'Prioridades' && result?.priorityData"
    class="results-grid additional-metrics"
  >
    <div class="card">
      <h5>Clientes de Alta Prioridad (Clase 1)</h5>
      <div class="metric">
        <span class="metric-label">Clientes en el sistema (L‚ÇÅ):</span>
        <span class="metric-value">{{
          getClass1Value("L") | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Clientes en cola (Lq‚ÇÅ):</span>
        <span class="metric-value">{{
          getClass1Value("Lq") | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Tiempo en sistema (W‚ÇÅ):</span>
        <span class="metric-value">{{
          getClass1Value("W") | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Tiempo en cola (Wq‚ÇÅ):</span>
        <span class="metric-value">{{
          getClass1Value("Wq") | number : "1.4-4"
        }}</span>
      </div>
    </div>

    <div class="card">
      <h5>Clientes de Baja Prioridad (Clase 2)</h5>
      <div class="metric">
        <span class="metric-label">Clientes en el sistema (L‚ÇÇ):</span>
        <span class="metric-value">{{
          getClass2Value("L") | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Clientes en cola (Lq‚ÇÇ):</span>
        <span class="metric-value">{{
          getClass2Value("Lq") | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Tiempo en sistema (W‚ÇÇ):</span>
        <span class="metric-value">{{
          getClass2Value("W") | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Tiempo en cola (Wq‚ÇÇ):</span>
        <span class="metric-value">{{
          getClass2Value("Wq") | number : "1.4-4"
        }}</span>
      </div>
    </div>

    <div class="card">
      <h5>Comparaci√≥n entre Clases</h5>
      <div class="metric">
        <span class="metric-label">Ratio tiempo espera (W‚ÇÇ/W‚ÇÅ):</span>
        <span class="metric-value">{{
          getWaitTimeRatio() | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Ratio tiempo cola (Wq‚ÇÇ/Wq‚ÇÅ):</span>
        <span class="metric-value">{{
          getQueueTimeRatio() | number : "1.4-4"
        }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">Proporci√≥n clientes tipo 1:</span>
        <span class="metric-value"
          >{{ getPriorityRatio() | number : "1.2-2" }}%</span
        >
      </div>
    </div>
  </div>
</div>
